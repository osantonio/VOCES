{% extends "layout/base.html" %}

{% block title %}{{ usuario.nombres.split()[0] }} {{ usuario.apellidos.split()[0] }} (@{{ usuario.username }}) - VOCES{%
endblock %}

{% block content %}
<div class="min-h-screen bg-background">
    <div class="max-w-2xl mx-auto w-full px-4 sm:px-6 py-5 sm:py-8">

        <!-- Header del Perfil -->
        <div class="flex flex-col gap-4 pb-4 border-b border-border">
            <!-- Avatar, Nombre y Botón de Acción -->
            <div class="flex items-start justify-between gap-4">
                <!-- Avatar y Nombre -->
                <div class="flex gap-3 sm:gap-4 items-start flex-1 min-w-0">
                    <!-- Avatar con Estado -->
                    <div class="relative shrink-0">
                        <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden border-2 border-border">
                            {% if usuario.avatar_url %}
                            <img src="{{ usuario.avatar_url }}" alt="Avatar de {{ usuario.username }}"
                                class="w-full h-full object-cover">
                            {% else %}
                            <div class="w-full h-full bg-accent flex items-center justify-center">
                                <span class="text-xl sm:text-2xl font-bold text-accent-foreground">{{
                                    user_initials(usuario) }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% set online = usuario.en_linea if usuario.en_linea is defined else False %}
                        <span
                            class="absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-background {{ 'bg-green-500' if online else 'bg-gray-400' }}"
                            aria-label="{{ 'En línea' if online else 'Desconectado' }}"></span>
                    </div>

                    <!-- Información del Usuario -->
                    <div class="flex flex-col gap-1 flex-1 min-w-0">
                        <h1 class="text-foreground text-lg sm:text-xl font-bold leading-tight">
                            {{ usuario.nombres.split()[0] }} {{ usuario.apellidos.split()[0] }}
                        </h1>
                        <p class="text-muted-foreground text-sm">@{{ usuario.username }}</p>
                        <p class="text-muted-foreground text-sm">
                            Se unió el {{ usuario.creado_en.strftime('%B de %Y') if usuario.creado_en else 'N/A' }}
                        </p>
                    </div>
                </div>

                <!-- Botón de Acción -->
                <div class="shrink-0">
                    {% set usuario_actual = request.state.usuario_actual %}

                    {% if usuario_actual and usuario_actual.username == usuario.username %}
                    {# Es el perfil del usuario actual - Mostrar botón "Editar perfil" #}
                    <a href="/usuarios/{{ usuario.username }}/editar"
                        class="inline-flex items-center justify-center gap-2 rounded-full text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-border bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4">
                        Editar perfil
                    </a>
                    {% else %}
                    {# No es el perfil del usuario actual - Mostrar botón "Seguir" #}
                    {# TODO: Implementar lógica de seguir/dejar de seguir cuando exista el modelo #}
                    <button
                        class="inline-flex items-center justify-center gap-2 rounded-full text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4">
                        Seguir
                    </button>
                    {% endif %}
                </div>
            </div>

            <!-- Estadísticas -->
            <div class="flex flex-wrap gap-4 sm:gap-6 text-sm">
                <div class="flex gap-1">
                    <span class="font-bold text-foreground">{{ usuario.total_publicaciones or 0 }}</span>
                    <span class="text-muted-foreground">Posts</span>
                </div>
                <div class="flex gap-1">
                    <span class="font-bold text-foreground">0</span>
                    <span class="text-muted-foreground">Seguidores</span>
                </div>
                <div class="flex gap-1">
                    <span class="font-bold text-foreground">0</span>
                    <span class="text-muted-foreground">Seguidos</span>
                </div>
                <div class="flex gap-1">
                    <span class="font-bold text-foreground">{{ usuario.total_comentarios or 0 }}</span>
                    <span class="text-muted-foreground">Comentarios</span>
                </div>
            </div>

            
        </div>

        <!-- Tabs de Navegación -->
        <div class="border-b border-border">
            <div class="flex">
                <a class="flex-1 flex items-center justify-center border-b-2 border-b-primary text-foreground py-4 px-4 hover:bg-accent/50 transition-colors"
                    href="#">
                    <p class="text-sm font-semibold">Posts</p>
                </a>
                <a class="flex-1 flex items-center justify-center border-b-2 border-b-transparent text-muted-foreground py-4 px-4 hover:bg-accent/50 transition-colors"
                    href="#">
                    <p class="text-sm font-semibold">Comentarios</p>
                </a>
                <a class="flex-1 flex items-center justify-center border-b-2 border-b-transparent text-muted-foreground py-4 px-4 hover:bg-accent/50 transition-colors"
                    href="#">
                    <p class="text-sm font-semibold">Likes</p>
                </a>
                <a class="flex-1 flex items-center justify-center border-b-2 border-b-transparent text-muted-foreground py-4 px-4 hover:bg-accent/50 transition-colors"
                    href="#">
                    <p class="text-sm font-semibold">Guardados</p>
                </a>
            </div>
        </div>

        <!-- Contenido de los Tabs -->
        <div class="py-8">
            <div class="text-center text-muted-foreground">
                <p class="text-sm">El contenido de los tabs se mostrará aquí cuando se implementen los modelos
                    correspondientes.</p>
            </div>
        </div>

    </div>
</div>
{% endblock %}
